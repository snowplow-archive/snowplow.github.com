<!DOCTYPE html>
<html>
<head>
	
	<title>Funnel analysis - Snowplow Analytics</title>
	

	<link rel="icon" type="image/x-icon" href="/favicon.ico" />

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="/static/css/styles.css" type="text/css" rel="stylesheet" />
	<link href="/static/css/pygments.css" type="text/css" rel="stylesheet" />
	
	<!--For the homepage slider-->
	<link rel="stylesheet" href="/static/css/nivo-slider.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/static/css/nivo-slider-theme-default.css" type="text/css" media="screen" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	<script src="/static/js/jquery-nivo-slider-pack.js" type="text/javascript" ></script>
	<!--MathJax http://www.mathjax.org/-->
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_HTMLorMML.js"></script>
	<script type="text/javascript">
		MathJax.Hub.Config({
	      tex2jax: {
	        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
	      }
	    });
	    MathJax.Hub.Queue(function() {
	        var all = MathJax.Hub.getAllJax(), i;
	        for(i=0; i < all.length; i += 1) {
	            all[i].SourceElement().parentNode.className += ' has-jax';
	        }
    	});
	</script>
	<!-- end mathjax -->
	<!-- typekit -->
	<script type="text/javascript" src="//use.typekit.net/noo1diw.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<!-- end typekit -->
</head>
<body>
	<!-- Google Tag Manager -->
	<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-DLRG"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-DLRG');</script>
	<!-- End Google Tag Manager -->

	<div id="container">
		<div id="header" class="span-24">
  <div id="logo">
    <h1><a href="/"><img src="/static/img/snowplow-logo-website.png" title="Snowplow Analytics" /></a></h1>
  </div>
  <div id="menu" class="span-15">
    <ul>
      <li ><a href="/product/index.html">Product</a></li>
      <li ><a href="/services/index.html">Services</a></li>
      <li  class="active" ><a href="/analytics/index.html">Analytics</a></li>
      <li ><a href="/technology/index.html">Technology</a></li>
      <li ><a href="/blog.html">Blog</a></li>
      <li ><a id="mail" href="/about/index.html">About</a></li>
    </ul>
  </div>
</div>
	
		<div id="contents">
<a name='top'><h1>Funnel analysis</h1></a>
<ol>
<li><a href='#overview'>An overview of funnel analysis</a></li>

<li><a href='#strengths-and-limitations'>Strengths and limitations of funnel analyses</a></li>

<li><a href='#any-funnel'>With Snowplow, you can analyse <strong>any funnel</strong></a></li>

<li><a href='#example'>Performing funnel analysis in Snowplow: a worked example</a></li>

<li><a href='#tableau'>Visaulizing funnel analysis with Tableau</a></li>

<li><a href='#r'>Visualizing funnel analysis with R</a></li>
</ol>
<a name='overview'><h2>1. An overview of funnel analysis</h2></a>
<p>Funnel analysis is one of the two most common types of platform analytics performed with web analytics data.</p>

<p>The concept behind funnel analysis is straightforward. Your platform is designed to support users working through one or more different workflows: where each workflow is a series of steps necessary to deliver a specific outcome. Examples of workflows include:</p>

<ol>
<li>Buying a product</li>

<li>Paying a bill</li>

<li>Researching the answer to a specific question</li>

<li>Signing up for a service</li>

<li>Checking your bank balance</li>
</ol>

<p>In a funnel analysis, you:</p>

<ol>
<li>Identify a specific workflow: this is your funnel</li>

<li>Identify the steps that a user must take to work through that funnel</li>

<li>Identify the set of users who start on that funnel</li>

<li>Analyse what fraction of that set of users drop out at each step in the funnel</li>

<li>Work out what caused the user to drop out of the funnel, with a view to improving your product so that a smaller fraction of users drop out at each step.</li>
</ol>

<p>Funnel analysis is very commonly employed on online shops, for example, to understand what fraction of visitors to the website &#8216;convert&#8217; (i.e. make a purchase), and how far other users make it through the purchase funnel. This sort of analysis is typically used to optimize the checkout process, for example.</p>

<p>Back to <a href='#top'>top</a>.</p>
<a name='strengths-and-limitations'><h2>2. Strengths and limitations of funnel analyses</h2></a>
<p>The primary strength of a funnel analysis is that it is incredibly actionable: a funnel analysis will tell you very specifically where on a user journey the platform is not working so well (because users are dropping out of the workflow at a specific step in the workflow). It then becomes possible to test different iterations of your platform and compare the drop-off between versions, measure any uplift and quantify the associated benefit.</p>

<p>There are two primary limitations of funnel analyses, which are worth elaborating on in a little detail, before we proceed:</p>

<ol>
<li><a href='#who-to-include'>It is not always straightforward to identify which users should be included in the funnel analysis</a></li>

<li><a href='#difficult-to-distinguish-workflow'>Funnel analysis is not effective for measuring platform performance where different workflows can be distinguished so easily</a></li>
</ol>
<a name='who-to-include'><h3>Who to include in a funnel analysis?</h3></a>
<p>A funnel analysis measures the &#8216;effectiveness&#8217; of your platform by enabling you to measure the fraction of users who drop out at each stage of the funnel: any drop off is taken to be a fault of the platform that needs to be rectified. A perfect platform, then, is one where all users who embark on a workflow finish it.</p>

<p>One of the problems, however, with these assumptions, is that in the real world, it is possible for a user to accidentally start a workflow. By &#8220;accidentally&#8221;, we mean that the user has no desire or intention to get to the end of the workflow.</p>

<p>If you have a lot of users accidentally starting a workflow, it is likely that your drop off rates at each step will be much higher than you&#8217;d hope. This does not mean that there is something wrong with the steps in the workflow: instead it means that the wrong people are being pushed into the funnel.</p>

<p>In an ideal world, you should <strong>only include users / visitors in a funnel analysis who have clearly (through their online behavior) expressed a desire for the outcome of the workflow</strong>. If you run an online shop, for example, you should include all visitors who&#8217;ve come to your site to buy products, but exclude users who are visiting e.g. to look up your contact details, or want to arrange a refund, for example.</p>
<a name='difficult-to-distinguish-workflow'><h3>Can we distinguish different workflows in our platform clearly?</h3></a>
<p>On some platforms it is very easy to define one or more workflows. On a lead-generation microsite, for example, there is generally <em>nothing</em> for a user to do <em>except</em> for filling in a webform and submitting their details.</p>

<p>On many platforms, however, there are multiple things that a visitor might want to do and correspondingly, multiple workflows that they embark on. Consider the case of an online marketplace like eBay for example. A visitor may arrive with the intention of buying a specific item. She may arrive with the intention of buying something (e.g. a present), but without a clear idea what it is she&#8217;d like to buy. She may, alternatively, be on the website to sell something. Or she may be in the market either to buy or sell something, but only for the right price: hence she is on the website to determine the price she&#8217;d be able to buy / sell an item for.</p>

<p>Working out the intentions of the user is key to knowing which funnel analysis to include this user on. To complicate matters further, however, many of the funnels &#8220;overlap&#8221;: the user journey for researching the price of an item (either to buy or to sell) may start off almost exactly the same as the user journey for buying a specific item, for example. Without a reliable way to segment users into each workflow, it becomes impossible to perform funnel analysis for either of the two overlapping workflows.</p>

<p>The less clearly we can distinguish users with different intentions and different workflows with different goals, the less useful (and potentially more misleading) funnel analyses become.</p>

<p>Back to <a href='#top'>top</a>.</p>
<a name='any-funnel'><h2>3. With Snowplow, you can analyse <strong>any funnel</strong></h2></a>
<p>In web analytics, funnel analyses have been made especially popular by Google Analytics.</p>

<p>The major limitation of performing funnel analytics in GA, however, is that the funnel has to be defined in advance of collecting data. So, if you want to track the progress of users through your online shop to purchase, for example, you need to create your funnel, wait a few weeks until you have sufficient data to make an analysis statistically significant, and then perform the analysis.</p>

<p>In Snowplow by contrast, you can define <em>any</em> funnel retrospectively on the data you have already collected. This gives you a lot more flexibility to explore a wide variety of workflows that your users are working through, some of which you may not have been aware existed before you started mining your Snowplow data.</p>

<p>In the rest of this recipe, we run through the process of performing a funnel analysis with Snowplow data.</p>

<p>Back to <a href='#top'>top</a>.</p>
<a name='example'><h2>4. Performing funnel analysis in Snowplow: a worked example</h2></a>
<p>For our worked example, we&#8217;re going to perform a funnel analysis for an online retailer: <a href='http://www.psychicbazaar.com/index.php'>www.psychicbazaar.com</a>. We&#8217;re going to look at the purchase funnel, and the following specific steps on it:</p>

<ol>
<li>Visiting the website</li>

<li>Adding a product to the basket</li>

<li>Starting to fill in the checkout form</li>

<li>Finishing the checkout form, and going to Paypal to make a payment</li>

<li>Completing the order</li>
</ol>

<p>We&#8217;re going to build up a query, in steps, that returns a line of data for each our visits, with details of what stage in the funnel the user gets to.</p>

<h3 id='step_1_identifying_visitors_to_include_in_our_funnel_analysis'>Step 1: identifying visitors to include in our funnel analysis</h3>

<p>It is straightforward to run a query to return the list of visits for our website:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>MIN</span><span class='p'>(</span><span class='kt'>TIMESTAMP</span><span class='p'>(</span><span class='n'>collector_dt</span><span class='p'>,</span> <span class='n'>collector_tm</span><span class='p'>))</span> <span class='k'>AS</span> <span class='n'>tstamp</span>
<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<p>For this tutorial, we&#8217;re going to include <em>all</em> the visitors who come to the website in our funnel analysis. However, as highlighted <a href='#who-to-include'>above</a>, we might want to refine this to users who&#8217;ve come to the website from specific marketing channels or who have landed on a subset of landing pages (e.g. on the shop rather than the blog, for example).</p>

<h3 id='step_2_identify_which_of_those_users_added_a_product_to_basket'>Step 2: identify which of those users added a product to basket</h3>

<p>On the Psychic Bazaar website, add-to-baskets are AJAX events that are tracked using Snowplow&#8217;s <a href='https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#wiki-custom-structured-events'>custom structured event tracking</a>. When an add-to-basket occurs, a custom event is fired with:</p>

<ul>
<li><code>ev_category</code> = &#8216;ecomm&#8217;</li>

<li><code>ev_action</code> = &#8216;add-to-basket&#8217;</li>

<li><code>ev_label</code> = product SKU</li>

<li><code>ev_property</code> = quantity of product added to basket</li>

<li><code>ev_value</code> = value of goods added to basket</li>
</ul>

<p>We can therefore return all the add-to-basket events with the following query:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>COUNT</span><span class='p'>(</span><span class='o'>*</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_add_to_baskets</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_property</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_items_added</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_value</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>value_of_goods_added</span>
<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;add-to-basket&#39;</span>
<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<p>We can combine this data with our visits data:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span><span class='p'>,</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span><span class='p'>,</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>tstamp</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>number_of_add_to_baskets</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>number_of_items_added</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>value_of_goods_added</span><span class='p'>,</span>
<span class='k'>FROM</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>MIN</span><span class='p'>(</span><span class='kt'>TIMESTAMP</span><span class='p'>(</span><span class='n'>collector_dt</span><span class='p'>,</span> <span class='n'>collector_tm</span><span class='p'>))</span> <span class='k'>AS</span> <span class='n'>tstamp</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>domain_userid</span> <span class='k'>IS</span> <span class='k'>NOT</span> <span class='no'>NULL</span>
	<span class='k'>AND</span> <span class='n'>page_url</span> <span class='k'>LIKE</span> <span class='s1'>&#39;%psychicbazaar.com%&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>v</span> 
<span class='k'>LEFT</span> <span class='k'>JOIN</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>COUNT</span><span class='p'>(</span><span class='o'>*</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_add_to_baskets</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_property</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_items_added</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_value</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>value_of_goods_added</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
	<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;add-to-basket&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>a</span> <span class='k'>ON</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='k'>AND</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>.</span><span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<h3 id='step_3_identifying_users_who_started_to_fill_in_the_checkout_form'>Step 3: Identifying users who <em>started</em> to fill in the checkout form</h3>

<p>The Psychic Bazaar checkout page is a long webform where the user enters all the required postage details (e.g. name, email address, shipping address).</p>

<p>A Snowplow structured event tag is fired when a user enters a value in any of the webform entries. For the sakes of keeping this tutorial simple, we&#8217;re going to count starting to fill in the webform (by entering an email address) as a step, and submitting the webform (and going to Paypal) as the next step. We will ignore the intervening steps, although we could easily extend our query to include them as well.</p>

<p>When a user enters their email address at the top of the checkout page, a structured event is fired where:</p>

<ul>
<li><code>ev_category</code> = &#8216;ecomm&#8217;</li>

<li><code>ev_action</code> = &#8216;checkout&#8217;</li>

<li><code>ev_label</code> = &#8216;id_email&#8217;</li>
</ul>

<p>So to identify which visits included this step we execute the following query:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span>	
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='mi'>1</span> <span class='k'>AS</span> <span class='n'>start_checkout</span>
<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;checkout&#39;</span>
<span class='k'>AND</span>  <span class='n'>ev_label</span> <span class='o'>=</span> <span class='s1'>&#39;id_email&#39;</span>
<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<h3 id='step_4_identifying_users_who_finished_the_checkout_form'>Step 4: Identifying users who <em>finished</em> the checkout form</h3>

<p>When a user clicks the submit button on the bottom of the checkout page, a structured event is fired where:</p>

<ul>
<li><code>ev_category</code> = &#8216;ecomm&#8217;</li>

<li><code>ev_action</code> = &#8216;checkout&#8217;</li>

<li><code>ev_label</code> = &#8216;paypal-button&#8217;</li>
</ul>

<p>To identify which visits included this step we execute the following query:</p>
<div class='highlight'><pre><code class='mysql'><span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>COUNT</span><span class='p'>(</span><span class='o'>*</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_clicks_on_paypal_button</span>
<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;checkout&#39;</span>
<span class='k'>AND</span> <span class='n'>ev_label</span> <span class='o'>=</span> <span class='s1'>&#39;paypal-button&#39;</span>
<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<h3 id='step_5_identifying_users_who_complete_their_order'>Step 5: Identifying users who complete their order</h3>

<p>When a user completes his / her order, a <a href='https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#wiki-ecommerce'>transaction event</a> is fired. We can therefore identify all the visits where there was a sale by executing the following query:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span> 
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='n'>tr_orderid</span><span class='p'>,</span>
	<span class='n'>tr_total</span>
<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
<span class='k'>WHERE</span> <span class='n'>event</span> <span class='o'>=</span> <span class='s1'>&#39;transaction&#39;</span>
<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span><span class='p'>,</span> <span class='n'>tr_orderid</span><span class='p'>,</span> <span class='n'>tr_total</span>
</code></pre>
</div>
<h3 id='step_6_consolidating_the_different_queries_into_a_single_query_that_returns_the_complete_data_set'>Step 6: Consolidating the different queries into a single query that returns the complete data set</h3>

<p>We can join the above queries together into a single query that generates a complete data set, with one row of data per visit, where it is straightforward to deduce from the columns what stage in the workflow each customer made it:</p>
<div class='highlight'><pre><code class='mysql'><span class='cm'>/* Infobright / MySQL */</span>
<span class='k'>SELECT</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span><span class='p'>,</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span><span class='p'>,</span>
<span class='n'>v</span><span class='p'>.</span><span class='n'>tstamp</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>number_of_add_to_baskets</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>number_of_items_added</span><span class='p'>,</span>
<span class='n'>a</span><span class='p'>.</span><span class='n'>value_of_goods_added</span><span class='p'>,</span>
<span class='n'>c</span><span class='p'>.</span><span class='n'>start_checkout</span><span class='p'>,</span>
<span class='n'>fc</span><span class='p'>.</span><span class='n'>number_of_clicks_on_paypal_button</span><span class='p'>,</span>
<span class='n'>o</span><span class='p'>.</span><span class='n'>tr_orderid</span><span class='p'>,</span>
<span class='n'>o</span><span class='p'>.</span><span class='n'>tr_total</span>
<span class='k'>FROM</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>MIN</span><span class='p'>(</span><span class='kt'>TIMESTAMP</span><span class='p'>(</span><span class='n'>collector_dt</span><span class='p'>,</span> <span class='n'>collector_tm</span><span class='p'>))</span> <span class='k'>AS</span> <span class='n'>tstamp</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>page_url</span> <span class='k'>LIKE</span> <span class='s1'>&#39;%psychicbazaar.com%&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>v</span> 
<span class='k'>LEFT</span> <span class='k'>JOIN</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>COUNT</span><span class='p'>(</span><span class='o'>*</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_add_to_baskets</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_property</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_items_added</span><span class='p'>,</span>
	<span class='nf'>SUM</span><span class='p'>(</span><span class='n'>ev_value</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>value_of_goods_added</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
	<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;add-to-basket&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>a</span> <span class='k'>ON</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='k'>AND</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>.</span><span class='n'>domain_sessionidx</span>
<span class='k'>LEFT</span> <span class='k'>JOIN</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='mi'>1</span> <span class='k'>AS</span> <span class='n'>start_checkout</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
	<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;checkout&#39;</span>
	<span class='k'>AND</span> <span class='p'>(</span><span class='n'>ev_label</span> <span class='o'>=</span> <span class='s1'>&#39;email&#39;</span> <span class='k'>OR</span> <span class='n'>ev_label</span> <span class='o'>=</span> <span class='s1'>&#39;id_email&#39;</span><span class='p'>)</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>c</span> <span class='k'>ON</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='o'>=</span> <span class='n'>c</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='k'>AND</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span> <span class='o'>=</span> <span class='n'>c</span><span class='p'>.</span><span class='n'>domain_sessionidx</span>
<span class='k'>LEFT</span> <span class='k'>JOIN</span> <span class='p'>(</span>
	<span class='k'>SELECT</span>
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='nf'>COUNT</span><span class='p'>(</span><span class='o'>*</span><span class='p'>)</span> <span class='k'>AS</span> <span class='n'>number_of_clicks_on_paypal_button</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>ev_category</span> <span class='o'>=</span> <span class='s1'>&#39;ecomm&#39;</span>
	<span class='k'>AND</span> <span class='n'>ev_action</span> <span class='o'>=</span> <span class='s1'>&#39;checkout&#39;</span>
	<span class='k'>AND</span> <span class='n'>ev_label</span> <span class='o'>=</span> <span class='s1'>&#39;paypal-button&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span>
<span class='p'>)</span> <span class='n'>fc</span> <span class='k'>ON</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='o'>=</span> <span class='n'>fc</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='k'>AND</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span> <span class='o'>=</span> <span class='n'>fc</span><span class='p'>.</span><span class='n'>domain_sessionidx</span>
<span class='k'>LEFT</span> <span class='k'>JOIN</span> <span class='p'>(</span>
	<span class='k'>SELECT</span> 
	<span class='n'>domain_userid</span><span class='p'>,</span>
	<span class='n'>domain_sessionidx</span><span class='p'>,</span>
	<span class='n'>tr_orderid</span><span class='p'>,</span>
	<span class='n'>tr_total</span>
	<span class='k'>FROM</span> <span class='ss'>`events_008`</span>
	<span class='k'>WHERE</span> <span class='n'>event</span> <span class='o'>=</span> <span class='s1'>&#39;transaction&#39;</span>
	<span class='k'>GROUP</span> <span class='k'>BY</span> <span class='n'>domain_userid</span><span class='p'>,</span> <span class='n'>domain_sessionidx</span><span class='p'>,</span> <span class='n'>tr_orderid</span><span class='p'>,</span> <span class='n'>tr_total</span>
<span class='p'>)</span> <span class='n'>o</span> <span class='k'>ON</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='o'>=</span> <span class='n'>o</span><span class='p'>.</span><span class='n'>domain_userid</span> <span class='k'>AND</span> <span class='n'>v</span><span class='p'>.</span><span class='n'>domain_sessionidx</span> <span class='o'>=</span> <span class='n'>o</span><span class='p'>.</span><span class='n'>domain_sessionidx</span>
</code></pre>
</div>
<p>The output of the query looks something like this (click to enlarge):</p>
<a href='/static/img/analytics/platform-analytics/funnel-analysis/funnel-data.png'><img src='/static/img/analytics/platform-analytics/funnel-analysis/funnel-data.png' /></a>
<p>Now that we have our data ready, we can visualize and interrogate it further in <a href='#tableau'>Tableau</a> or <a href='#r'>R</a>.</p>

<p>Back to <a href='#top'>top</a>.</p>
<a name='tableau'><h2>5. Visualizing funnel analysis with Tableau</h2></a>
<p>First, create a new data source in Tableau, and execute the above query to pull the required data from Snowplow into Tableau.</p>

<p>Tableau assumes that <code>domain_sessionidx</code> is a metric - drag it from the &#8220;Measures&#8221; pane to the &#8220;Dimensions pane&#8221; to set Tableau straight.</p>

<p>Next let&#8217;s create a single dimension to capture how far in the funnel each visit is. Create another calcualted field, and enter the following in the formula window:</p>
<div class='highlight'><pre><code class='numpy'><span class='n'>IF</span><span class='p'>([</span><span class='n'>tr_total</span><span class='p'>]</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='n'>THEN</span> <span class='s'>&#39;5. Order complete&#39;</span>
<span class='n'>ELSEIF</span> <span class='p'>([</span><span class='n'>number_of_clicks_on_paypal_button</span><span class='p'>]</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='n'>THEN</span> <span class='s'>&#39;4. Checkout finished&#39;</span>
<span class='n'>ELSEIF</span> <span class='p'>([</span><span class='n'>start_checkout</span><span class='p'>]</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='n'>THEN</span> <span class='s'>&#39;3. Started checkout&#39;</span>
<span class='n'>ELSEIF</span> <span class='p'>([</span><span class='n'>number_of_add_to_baskets</span><span class='p'>]</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='n'>THEN</span> <span class='s'>&#39;2. Added product(s) to basket&#39;</span>
<span class='n'>ELSE</span> <span class='s'>&#39;1. Visit&#39;</span> <span class='n'>END</span>
</code></pre>
</div>
<p>This field categorises each session by how far in the funnel the user progressed. Call this field &#8216;Funnel&#8217; and save it.</p>

<p>Now we can plot how the funnel has changed over time, for example. Drag &#8216;Funnel&#8217; to the Rows shelf, drag &#8216;tstamp&#8217; to the columns shelf, set &#8216;tstamp&#8217; to the desired time period (e.g. months). Then drag the &#8216;Number of Records&#8217; measure into the table. (Remember - for our data set - each record represents one session.)</p>

<p>To make it easier to compare funnels between time periods, let&#8217;s plot percentages of visits rather than actual numbers. Click on the measure &#8216;SUM(Number of Records)&#8217;, select &#8216;Add Table Calculation&#8217; from the drop down and select &#8216;Calculation Type: Percent of Total&#8217; and &#8216;Summarize the values from: Table (Down)&#8217;. Your data set should look something like this:</p>

<p><img alt='data-in-tableau' src='/static/img/analytics/platform-analytics/funnel-analysis/data-in-tableau.jpg' /></p>

<p>We can now plot the results using a stacked bar graph. Click on the stacked bar icon in the &#8216;Show Me&#8217; toolbar to do this:</p>

<p><img alt='visualization-in-tableau' src='/static/img/analytics/platform-analytics/funnel-analysis/visualization-in-tableau.jpg' /></p>

<p>Note: in the above graph we&#8217;ve editted the y-axis so instead of extending from 0-100%, it extends from 0-10%, to make it easier to read.</p>

<p>The above graph is clear to read. It tells a worrying story: conversion rates on Psychic Bazaar have dropped since a peak in January 2013.</p>

<p>Back to <a href='#top'>top</a>.</p>
<a name='r'><h2>6. Visualizing funnel analysis with R</h2></a>
<p><em>This part of the tutorial will be written shortly</em>.</p>

<p>Back to <a href='#top'>top</a>.</p>
</div>

 <div id="sidebar">
	<h1>Analysts Cookbook</h1>
	<p>
		<a href="/analytics/index.html" >Overview</a>
		
	</p>
	<p>
		<a href="/analytics/customer-analytics/overview.html" >Customer analytics</a>
		
	</p>
	<p>
		<a href="/analytics/catalog-analytics/overview.html" >Catalog analytics</a>
		
	</p>
	<p>
		<a href="/analytics/platform-analytics/overview.html" class="active">Platform analytics</a>
		
		<ul>
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
						
							
							<li><a href="/analytics/platform-analytics/overview.html">Overview</a></li>
									
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
						
							
							<li class="active"><a href="/analytics/platform-analytics/funnel-analysis.html" class="active">Funnel analysis</a></li>
									
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
						
							
							<li><a href="/analytics/platform-analytics/sankey-diagrams-with-d3-js.html">Visualizing user journeys with Sankey diagrams in D3.js</a></li>
									
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
									
					
				
					
									
					
				
					
									
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
					
				
			
		</ul>		
		
	</p>
	<p>
		<a href="/analytics/tools-and-techniques/overview.html" >Tools and techniques</a>
		
	</p>
</div>

		<div id="footer">
	<p>Copyright Â© Snowplow Analytics Limited 2012 - 2013.  All rights reserved</p>
</div>
	</div>
		<!-- Following Javascript function used by Disqus to count the number of comments for each blog post and display in the main index -->
	  	<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'snowplow'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        </script>
        <!-- begin olark code -->
		<script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
		f[z]=function(){
		(a.s=a.s||[]).push(arguments)};var a=f[z]._={
		},q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
		f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
		0:+new Date};a.P=function(u){
		a.p[u]=new Date-a.p[0]};function s(){
		a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
		hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
		return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
		b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
		b.contentWindow[g].open()}catch(w){
		c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
		var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
		b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
		loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
		/* custom configuration goes here (www.olark.com/documentation) */
		olark.identify('9752-503-10-5227');/*]]>*/</script><noscript><a href="https://www.olark.com/site/9752-503-10-5227/contact" title="Contact us" target="_blank">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
		<!-- end olark code -->
		<!-- Track Olark chats in GTM (so can pass data onto Snowplow) -->
		<script type="text/javascript">
		olark('api.chat.onMessageToOperator', function(event) {
		    dataLayer.push({'event': 'olarkMessageToOperator'});
		});
		olark('api.chat.onMessageToVisitor', function(event) {
		    dataLayer.push({'event': 'olarkMessageToVisitor'});
		});
		</script>
		<!-- end track olark code -->


</body>
</html>