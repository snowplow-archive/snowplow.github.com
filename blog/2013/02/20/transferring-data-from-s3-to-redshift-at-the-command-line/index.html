<!DOCTYPE html>
<html>
<head>
	
	<title>Bulk loading data from Amazon S3 into Redshift at the command line - SnowPlow Analytics</title>
	

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="/static/css/styles.css" type="text/css" rel="stylesheet" />
	<link href="/static/css/pygments.css" type="text/css" rel="stylesheet" />
	

	<!--For the homepage slider-->
	<link rel="stylesheet" href="/static/css/nivo-slider.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/static/css/nivo-slider-theme-default.css" type="text/css" media="screen" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	<script src="/static/js/jquery-nivo-slider-pack.js" type="text/javascript" ></script>
</head>
<body>
	<!-- Google Tag Manager -->
	<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-DLRG"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-DLRG');</script>
	<!-- End Google Tag Manager -->

	<div id="container">
		<div id="header" class="span-24">
  <div id="logo">
    <h1><a href="/">SnowPlow</a></h1>
    <p>Your web analytics data in your hands</p>
  </div>
  <div id="menu" class="span-15">
    <ul>
      <li ><a href="/product/index.html">Product</a></li>
      <li ><a href="/services/index.html">Services</a></li>
      <li ><a href="/analytics/index.html">Analytics</a></li>
      <li ><a href="/technology/index.html">Technology</a></li>
      <li  class="active" ><a href="/blog.html">Blog</a></li>
      <li ><a id="mail" href="/contact/index.html">Contact</a></li>
    </ul>
  </div>
</div>
	
		<div id="contents">
		<div class="post">
			20 Feb 2013
			<h1>Bulk loading data from Amazon S3 into Redshift at the command line</h1>
			<p>On Friday Amazon launched <a href='http://aws.amazon.com/redshift/'>Redshift</a>, a fully managed, petabyte-scale data warehouse service. We&#8217;ve been busy since building out SnowPlow support for Redshift, so that SnowPlow users can use Redshift to store their granular, customer-level and event-level data for OLAP analysis.</p>

<p>In the course of building out SnowPlow support for Redshift, we need to bulk load data stored in S3 into Redshift, programmatically. Unfortunately, the Redshift Java SDK is very slow at inserts, so not suitable bulk loading. We found a simple workaround that might be helpful for anyone who wishes to bulk load data into Redshift from S3, and have documented it below.</p>

<h2 id='an_overview_of_the_workaround'>An overview of the workaround</h2>

<p>Amazon enables users to bulk load data from S3 into Redshift by executing queries with the following form:</p>
<div class='highlight'><pre><code class='postgresql'><span class='k'>copy</span> <span class='n'>events</span> 
<span class='k'>from</span> <span class='s1'>&#39;s3://$MY-BUCKET/PATH/TO/FILES/FOR/UPLOAD&#39;</span> 
<span class='n'>credentials</span> <span class='s1'>&#39;aws_access_key_id=$ACCESS-KEY;aws_secret_access_key=$SECRET-ACCESS-KEY&#39;</span> 
<span class='k'>delimiter</span> <span class='s1'>&#39;\t&#39;</span><span class='p'>;</span>
</code></pre>
</div>
<p>However, these queries can only be executed in a SQL client running a JDBC or ODBC driver compatible with Redshift. (Links to those drivers can be found <a href='http://docs.aws.amazon.com/redshift/latest/gsg/before-you-begin.html#getting-started-download-tools'>here</a>. )</p>
<!--more-->
<p>In order to orchestrate bulk loading programmatically, we used <a href='http://www.xigole.com/software/jisql/jisql.jsp'>JiSQL</a>, a Java based command-line tool for executing SQL queries that uses a JDBC driver. JiSQL enables us to specify the specific, Redshift-compatible JDBC driver to use to establish the connection. This meant we could upgrade our Ruby <a href='https://github.com/snowplow/snowplow/wiki/setting-up-alternative-data-stores'>StorageLoader</a> to execute the relevant command-line syntax to initiate the regular data loads of SnowPlow data from S3 into Redshift.</p>

<h2 id='using_jisql_to_bulk_load_data_from_s3_to_redshift_at_the_commandline_a_step_by_step_guide'>Using JiSQL to bulk load data from S3 to Redshift at the command-line: a step by step guide</h2>

<h3 id='1_download_and_install_jisql'>1. Download and install JiSQL</h3>

<ul>
<li>Download JiSQL from <a href='http://www.xigole.com/software/jisql/jisql.jsp'>http://www.xigole.com/software/jisql/jisql.jsp</a></li>

<li>Unzip the contents of the compressed file to a suitable location</li>
</ul>

<h3 id='2_download_the_redshiftcompatible_jdbc_driver'>2. Download the Redshift-compatible JDBC driver</h3>

<ul>
<li>Download the driver from <a href='http://jdbc.postgresql.org/download/postgresql-8.4-703.jdbc4.jar'>http://jdbc.postgresql.org/download/postgresql-8.4-703.jdbc4.jar</a></li>

<li>We saved the driver to the <code>lib</code> folder in the jisql subdirectory</li>
</ul>

<h3 id='3_identify_the_jdbc_url_for_your_redshift_cluster'>3. Identify the JDBC URL for your Redshift cluster</h3>

<p>In the AWS Console, go to the Redshift and select the cluster you want to load data into. A window will appear with details about the cluster, including the JDBC URL.</p>

<p><img alt='screenshot' src='/static/img/blog/2013/02/redshift-jdbc-url.png' /></p>

<h3 id='4_initiate_your_bulk_load_of_data_at_the_command_line'>4. Initiate your bulk load of data at the command line</h3>

<ul>
<li>At the command line, navigate to the Ji-SQL folder</li>

<li>Execute the following command:</li>
</ul>
<div class='highlight'><pre><code class='bash'><span class='nv'>$ </span>java -cp lib/jisql-2.0.11.jar:lib/jopt-simple-3.2.jar:lib/postgresql-8.4-703.jdbc4.jar com.xigole.util.sql.Jisql  -driver postgresql -cstring jdbc:postgresql://snowplow.cjbccnwghslt.us-east-1.redshift.amazonaws.com:5439/snplow -user <span class='nv'>$USERNAME</span> -password <span class='nv'>$PASSWORD</span> -c <span class='se'>\;</span> -query <span class='s2'>&quot;copy events from &#39;s3://$MY_BUCKET/PATH/TO/FILES/FOR/UPLOAD credentials &#39;aws_access_key_id=$ACCESS-KEY;aws_secret_access_key=$SECRET-ACCESS-KEY&#39; delimiter &#39;\t&#39;;&quot;</span>
</code></pre>
</div>
<p>Some notes about the above query:</p>

<ul>
<li>You will need to replace e.g. <code>$USERNAME</code> with your Redshift cluster username, <code>$PASSWORD</code> with your Redshift password etc.</li>

<li>You will need to replace the jdbc url in the example <code>jdbc:postgresql://snowplow.cjbccnwghslt.us-east-1.redshift.amazonaws.com:5439/snplow</code> with the value you fetched from the AWS console in step 2</li>

<li>The <code>-c \;</code> flag sets <code>;</code> as the query delimiter. If this is not specified, the query delimiter is taken to be <code>go</code> by default. As the query specified is terminated by a <code>;</code> rather than a <code>go</code>, leaving out the <code>-c \;</code> flag would cause the program to hang, as it waits for the terminating characters before executing the query</li>

<li>If you want to experiment with the tool, you can leave off the <code>-query</code> parameter, in which case you&#8217;ll invoke an interactive command-line session</li>

<li>If the query is successful, it will return <code>0 rows affected.</code> at the command line. This is a bit misleading: if you then look in Redshift you&#8217;ll see the new rows have loaded.</li>
</ul>

<p>Happy bulk loading from the command line!</p>
			<div id="comments">
	<h2>Questions? Comments? Join the debate!</h2>
	 <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'snowplow'; // required: replace example with your forum shortname
            /* var disqus_identifier =  ; // unique ID so that disqus fetches the correct comments for each post
            var disqus_url =  ;
            var disqus_title =  ; */

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
		</div>
		<p>Return to the <a href="/blog.html">main blog page</a></p>

</div>

<div id="sidebar">
	<h1>Recent posts</h1>
	<ul>
		
			<li><a href="/blog/2013/02/25/snowplow-0.7.5-released-with-important-javascript-fix">SnowPlow 0.7.5 released with important JavaScript fix</a></li>
		
			<li><a href="/blog/2013/02/22/snowplow-0.7.4-released-for-better-eventstream-analytics">SnowPlow 0.7.4 released for better eventstream analytics</a></li>
		
			<li><a href="/blog/2013/02/20/transferring-data-from-s3-to-redshift-at-the-command-line">Bulk loading data from Amazon S3 into Redshift at the command line</a></li>
		
			<li><a href="/blog/2013/02/18/ideas-coming-out-of-februarys-measurecamp">Reflections on Saturday's Measurecamp</a></li>
		
			<li><a href="/blog/2013/02/15/snowplow-0.7.3-released">SnowPlow 0.7.3 released, tracking additional data</a></li>
		
	</ul>

	
		<h1>Releases</h1>
		<ul>
		
			
				<li><a href="/blog/2013/02/25/snowplow-0.7.5-released-with-important-javascript-fix">SnowPlow 0.7.5 released with important JavaScript fix</a></li>
			
				<li><a href="/blog/2013/02/22/snowplow-0.7.4-released-for-better-eventstream-analytics">SnowPlow 0.7.4 released for better eventstream analytics</a></li>
			
				<li><a href="/blog/2013/02/15/snowplow-0.7.3-released">SnowPlow 0.7.3 released, tracking additional data</a></li>
			
				<li><a href="/blog/2013/01/29/snowplow-0.7.2-released">SnowPlow 0.7.2 released, with the new no-JavaScript tracker</a></li>
			
				<li><a href="/blog/2013/01/29/introducing-the-no-js-tracker">Introducing the No-Javascript pixel tracker</a></li>
			
		
		</ul>		
	
		<h1>Inside the Plow</h1>
		<ul>
		
			
				<li><a href="/blog/2013/02/08/writing-hive-udfs-and-serdes">Writing Hive UDFs - a tutorial</a></li>
			
				<li><a href="/blog/2013/02/04/help-us-build-out-the-snowplow-event-model">Help us build out the SnowPlow Event Model</a></li>
			
				<li><a href="/blog/2013/01/09/from-etl-to-enrichment">The SnowPlow development roadmap for the ETL step - from ETL to enrichment</a></li>
			
				<li><a href="/blog/2013/01/07/the-clojure-collector-in-detail">Understanding the thinking behind the Clojure Collector, and mapping out its development going forwards</a></li>
			
		
		</ul>		
	
		<h1>Analytics</h1>
		<ul>
		
			
				<li><a href="/blog/2013/01/08/using-chartio-to-visualise-and-interrogate-snowplow-data">Using ChartIO to visualise and interrogate SnowPlow data</a></li>
			
				<li><a href="/blog/2012/12/17/transforming-snowplow-data-so-it-can-be-interrogated-by-olap-tools-like-tableau">Transforming SnowPlow data so that it can be interrogataed in BI / OLAP tools like Tableau, Qlikview and Pentaho</a></li>
			
				<li><a href="/blog/2012/10/24/web-analytics-with-tableau-and-snowplow">Performing web analytics on SnowPlow data using Tableau - a video demo</a></li>
			
		
		</ul>		
	
		<h1>Other</h1>
		<ul>
		
			
				<li><a href="/blog/2013/02/20/transferring-data-from-s3-to-redshift-at-the-command-line">Bulk loading data from Amazon S3 into Redshift at the command line</a></li>
			
				<li><a href="/blog/2013/02/18/ideas-coming-out-of-februarys-measurecamp">Reflections on Saturday's Measurecamp</a></li>
			
				<li><a href="/blog/2013/01/21/working-out-what-data-to-pass-into-your-tag-manager">What data should you be passing into your tag manager?</a></li>
			
				<li><a href="/blog/2013/01/20/snowplow-hits-202-stars">SnowPlow reaches 202 stars on GitHub</a></li>
			
				<li><a href="/blog/2013/01/18/using-snowplow-with-qubit-opentag">Implementing SnowPlow with QuBit's OpenTag</a></li>
			
		
		</ul>		
	
	

	<h1>Useful links</h1>
	<ul>
		<li><a href="/blog/atom.xml">Atom feed</a></li>
	</ul>
	<!--<strong>Tags</strong> -->
</div>

		<div id="footer">
	<p>Copyright Â© SnowPlow Analytics Limited 2012.  All rights reserved</p>
</div>
	</div>
	<!-- Following Javascript function used by Disqus to count the number of comments for each blog post and display in the main index -->
	  <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'snowplow'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        </script>
</body>
</html>